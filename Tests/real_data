library(ASMOT)
library(ggplot2)

# --- 1. Load All Four Datasets ---
# Ensure these files exist in your 'data/' folder
load("data/amgut1.filt.rda")      # Real Data A
load("data/amgut1.filt.cs.rda")   # Real Data B (CS version)
load("data/synth_zinb.rda")       # Model A
load("data/synth_htln.rda")       # Model B

# --- 2. Create Audit Objects (The 4 Comparisons) ---

# Comparison Set 1: Ground Truth = Standard Filtered
obj_filt_zinb <- create_asmot(real = amgut1.filt, synth = synth_zinb)
obj_filt_htln <- create_asmot(real = amgut1.filt, synth = synth_htln)

# Comparison Set 2: Ground Truth = CS Filtered
obj_cs_zinb   <- create_asmot(real = amgut1.filt.cs, synth = synth_zinb)
obj_cs_htln   <- create_asmot(real = amgut1.filt.cs, synth = synth_htln)

# --- 3. Run Audits ---
B_reps <- 50 # Increase to 100 for publication

message("Running Audit 1/4: Standard vs ZINB...")
res_filt_zinb <- asmot_audit(obj_filt_zinb, B = B_reps, weights = "auto")

message("Running Audit 2/4: Standard vs HTLN...")
res_filt_htln <- asmot_audit(obj_filt_htln, B = B_reps, weights = "auto")

message("Running Audit 3/4: CS vs ZINB...")
res_cs_zinb   <- asmot_audit(obj_cs_zinb, B = B_reps, weights = "auto")

message("Running Audit 4/4: CS vs HTLN...")
res_cs_htln   <- asmot_audit(obj_cs_htln, B = B_reps, weights = "auto")

# --- 4. Compile Results ---
results_df <- data.frame(
  Ground_Truth = c(rep("Standard (Filt)", 2), rep("CS (Filt.CS)", 2)),
  Model        = c("ZINB", "HTLN", "ZINB", "HTLN"),
  Realism      = c(res_filt_zinb$realism_score, res_filt_htln$realism_score,
                   res_cs_zinb$realism_score,   res_cs_htln$realism_score)
)

print(results_df)

# --- 5. Visualization: Grouped Bar Chart ---
# This clearly shows which model wins for each dataset type



ggplot(results_df, aes(x = Ground_Truth, y = Realism, fill = Model)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(aes(label = round(Realism, 1)), 
            position = position_dodge(width = 0.8), vjust = -0.5, size = 5) +
  scale_fill_manual(values = c("#E69F00", "#56B4E9")) + # Orange vs Blue
  ylim(0, 110) +
  labs(title = "Comprehensive Benchmark: ZINB vs HTLN",
       subtitle = "Comparing Geometric Fidelity against two Ground Truths",
       x = "Real Data Version Used",
       y = "ASMOT Realism Score (%)") +
  theme_minimal() +
  theme(text = element_text(size = 14))
